# FoxTrends 实施任务列表

## 阶段 1: 基础架构迁移

- [x] 1. 项目初始化和依赖管理


  - 创建 FoxTrends 项目目录结构
  - 从 BettaFish 复制核心配置文件（config.py, .env.example）
  - 创建 pyproject.toml 配置 UV 包管理
  - 使用 UV 安装所有依赖并生成 uv.lock
  - _验证需求: 1.3, 1.4, 7.4_




- [x] 1.1 编写属性测试：UV 依赖安装



  - **属性 1: 依赖安装完整性**
  - **验证需求: 1.4**

- [x] 1.2 配置系统迁移
  - 复制 BettaFish 的 pydantic-settings 配置系统
  - 创建 .env.example 模板文件


  - 实现配置加载和验证逻辑
  - 添加 FoxTrends 特定的配置项（社区监控、趋势分析）
  - _验证需求: 1.2, 7.1, 7.2_

- [x] 1.2.1 编写属性测试：配置加载一致性
  - **属性 1: 配置加载一致性**
  - **验证需求: 1.2**

- [x] 1.3 数据库连接迁移



  - 复制 BettaFish 的数据库连接代码
  - 保持 DB_DIALECT 配置支持 PostgreSQL 和 MySQL
  - 实现数据库初始化脚本
  - 测试数据库连接功能
  - _验证需求: 1.5, 7.3, 8.5_

- [x] 1.3.1 编写属性测试：数据库连接配置兼容性


  - **属性 2: 数据库连接配置兼容性**
  - **验证需求: 1.5**

- [x] 1.3.2 编写属性测试：数据库配置向后兼容

  - **属性 18: 数据库配置向后兼容**
  - **验证需求: 7.3**

- [x] 1.4 Flask 主应用迁移
  - 复制 app.py 主应用文件
  - 调整路由和 API 端点适应 FoxTrends
  - 保留 SocketIO 实时通信功能
  - 保留进程管理和日志监控功能
  - _验证需求: 1.1_

- [x] 1.5 ForumEngine 迁移
  - 复制 ForumEngine/monitor.py 和 llm_host.py
  - 保持日志监控和 Agent 协作机制
  - 调整 prompt 适应需求分析场景
  - 测试 ForumEngine 基本功能
  - _验证需求: 2.4, 6.1, 6.5_

- [x] 1.5.1 编写属性测试：ForumEngine 协作机制保留
  - **属性 3: ForumEngine 协作机制保留**
  - **验证需求: 2.4**

- [x] 1.5.2 编写属性测试：Agent 发言记录完整性
  - **属性 15: Agent 发言记录完整性**
  - **验证需求: 6.1**

- [x] 1.5.3 编写属性测试：讨论记录持久化
  - **属性 16: 讨论记录持久化**
  - **验证需求: 6.5**

- [x] 1.6 ReportEngine 迁移
  - 复制 ReportEngine 模块
  - 调整报告模板适应需求分析场景
  - 保持 HTML 生成和模板选择功能
  - _验证需求: 5.5_

- [x] 1.6.1 编写属性测试：报告生成幂等性
  - **属性 14: 报告生成幂等性**
  - **验证需求: 5.5**

- [x] 1.7 基础架构验证
  - 确保所有测试通过，询问用户是否有问题
  - _验证需求: 所有阶段 1 需求_


## 阶段 2: Agent 系统重构

- [x] 2. CommunityInsightAgent 开发（改造自 InsightEngine）
  - 复制 InsightEngine 的基础结构（agent.py, nodes/, state.py）
  - 重命名为 CommunityInsightAgent
  - 保留 FirstSummaryNode 和 ReflectionSummaryNode 节点
  - 调整 LLM prompt 适应社区需求分析
  - _验证需求: 2.1, 2.5_

- [x] 2.1 编写属性测试：Agent 节点模式一致性
  - **属性 4: Agent 节点模式一致性**
  - **验证需求: 2.5**

- [x] 2.2 CommunityInsightAgent 工具集适配
  - 修改数据库查询工具适应社区数据结构
  - 实现需求历史分析工具
  - 实现需求模式识别工具
  - 测试工具集功能
  - _验证需求: 2.1_

- [x] 2.3 ContentAnalysisAgent 开发（改造自 MediaEngine）
  - 复制 MediaEngine 的基础结构
  - 重命名为 ContentAnalysisAgent
  - 保留节点结构和多模态分析能力
  - 调整 prompt 适应社区内容分析
  - _验证需求: 2.2, 2.5_

- [x] 2.4 ContentAnalysisAgent 工具集适配
  - 适配文本分析工具
  - 适配代码片段分析工具
  - 实现需求分类工具
  - 测试工具集功能
  - _验证需求: 2.2_

- [x] 2.5 Agent 与 ForumEngine 集成测试
  - 启动两个 Agent 并验证输出格式
  - 验证 ForumEngine 能够监控所有 Agent
  - 验证主持人发言生成
  - 验证讨论记录完整性
  - _验证需求: 2.3, 5.1, 5.5_

- [x] 2.5.1 编写集成测试：Agent 协作流程
  - 测试两个 Agent 的完整协作流程
  - 验证 ForumEngine 的监控和主持功能
  - _验证需求: 2.3, 5.1_

- [x] 2.6 Agent 系统验证
  - 确保所有测试通过，询问用户是否有问题
  - _验证需求: 所有阶段 2 需求_

## 阶段 3: NicheEngine 开发

- [x] 3. 数据库表设计和创建
  - 设计 communities 表结构
  - 设计 demand_signals 表结构
  - 设计 agent_discussions 表结构
  - 创建数据库迁移脚本
  - 执行迁移并验证表结构
  - _验证需求: 8.1, 8.2, 8.4, 8.5_

- [x] 3.1 编写属性测试：外键约束完整性
  - **属性 19: 外键约束完整性**
  - **验证需求: 8.4**

- [x] 3.2 社区管理功能实现
  - 实现添加社区功能
  - 实现删除社区功能
  - 实现更新社区功能
  - 实现查询社区功能
  - _验证需求: 3.1_

- [x] 3.2.1 编写属性测试：多社区管理
  - **属性 5: 多社区管理**
  - **验证需求: 3.1**

- [x] 3.3 爬虫架构实现（复用 MindSpider）
  - 复制 MindSpider 的爬虫基础架构
  - 实现 Reddit 数据源适配器
  - 实现 GitHub Issues 数据源适配器
  - 实现 HackerNews 数据源适配器
  - _验证需求: 3.2_

- [x] 3.3.1 编写属性测试：数据采集完整性
  - **属性 6: 数据采集完整性**
  - **验证需求: 3.2, 3.3**

- [x] 3.4 需求信号提取实现
  - 实现痛点识别逻辑
  - 实现功能请求识别逻辑
  - 实现问题反馈识别逻辑
  - 使用 LLM 辅助分类
  - _验证需求: 3.4_

- [x] 3.4.1 编写属性测试：需求信号分类正确性
  - **属性 7: 需求信号分类正确性**
  - **验证需求: 3.4**

- [x] 3.5 监控状态管理实现
  - 实现监控状态更新功能
  - 实现监控进度查询功能
  - 实现实时状态推送（SocketIO）
  - _验证需求: 3.5_

- [x] 3.5.1 编写属性测试：监控状态一致性
  - **属性 8: 监控状态一致性**
  - **验证需求: 3.5**

- [x] 3.6 NicheEngine 集成测试
  - 测试完整的数据采集流程
  - 测试需求信号提取准确性
  - 测试数据存储完整性
  - _验证需求: 3.1, 3.2, 3.3, 3.4, 3.5_

- [x] 3.6.1 编写集成测试：NicheEngine 完整流程
  - 测试从社区添加到数据采集的完整流程
  - _验证需求: 3.1, 3.2, 3.3, 3.4_

- [x] 3.7 NicheEngine 验证
  - 确保所有测试通过，询问用户是否有问题
  - _验证需求: 所有阶段 3 需求_


## 阶段 4: Dashboard 开发

- [x] 4.1 Dashboard 基础架构
  - 设计 Dashboard 布局（基于 BettaFish 风格）
  - 创建 Flask 路由和 API 端点
  - 实现前端页面框架（HTML/CSS/JavaScript）
  - _验证需求: 4.1_

- [x] 4.2 社区监控面板实现
  - 实现社区列表展示
  - 实现监控状态实时更新（SocketIO）
  - 实现数据统计图表
  - _验证需求: 4.2_

- [x] 4.3 需求列表和详情实现
  - 实现需求列表展示（按热度排序）
  - 实现需求详情页面
  - 实现需求筛选和搜索
  - _验证需求: 4.3_

- [x] 4.3.1 编写属性测试：需求列表排序正确性
  - **属性 9: 需求列表排序正确性**
  - **验证需求: 4.3**

- [x] 4.4 报告导出功能实现
  - 集成 ReportEngine 生成报告（API 框架已完成）
  - 实现报告下载功能（HTML/PDF）- 待完善
  - 实现报告历史记录 - 待完善
  - _验证需求: 4.4_

- [x] 4.5 Dashboard API 端点实现
  - 实现社区管理 API
  - 实现需求查询 API
  - 实现报告生成 API
  - _验证需求: 4.1, 4.2, 4.3, 4.4_

- [x] 4.5.1 编写单元测试：Dashboard API 端点
  - 测试所有 API 端点的功能
  - _验证需求: 4.1, 4.2, 4.3, 4.4_

- [ ] 4.6 Dashboard 集成测试
  - 测试前后端交互
  - 测试实时数据更新
  - 测试图表渲染
  - _验证需求: 4.1, 4.2, 4.3, 4.4_

- [ ] 4.7 Dashboard 验证
  - 确保所有测试通过，询问用户是否有问题
  - _验证需求: 所有阶段 4 需求_


## 阶段 5: 集成测试和文档

- [ ] 6. 端到端测试
  - 编写完整需求分析流程的端到端测试
  - 测试从社区监控到报告生成的完整流程
  - 测试 Agent 协作和 ForumEngine 功能
  - _验证需求: 所有功能需求_

- [ ] 6.1 编写端到端测试：完整需求分析流程
  - 模拟用户添加社区、采集数据、分析趋势、生成报告的完整流程
  - _验证需求: 3.1, 3.2, 3.4, 4.1, 4.2, 4.5, 5.5_

- [ ] 6.2 性能测试和优化
  - 测试数据库查询性能
  - 测试 Agent 并发执行性能
  - 测试数据采集性能
  - 优化慢查询和瓶颈
  - _验证需求: 所有功能需求_

- [ ] 6.3 错误处理完善
  - 完善所有模块的错误处理
  - 实现优雅降级机制
  - 实现状态恢复机制
  - 添加详细的错误日志
  - _验证需求: 所有功能需求_

- [ ] 6.4 README 文档编写
  - 编写项目简介和功能说明
  - 编写快速开始指南
  - 编写 Docker 部署指南
  - 编写源码部署指南
  - _验证需求: 10.1_

- [ ] 6.5 配置指南编写
  - 编写 .env 配置说明
  - 编写 LLM 配置指南
  - 编写数据库配置指南
  - 编写社区数据源配置指南
  - _验证需求: 10.2_

- [ ] 6.6 开发文档编写
  - 编写代码结构说明
  - 编写 Agent 扩展指南
  - 编写数据源扩展指南
  - 编写 API 文档
  - _验证需求: 10.3_

- [ ] 6.7 示例和常见问题
  - 提供示例配置文件
  - 提供运行案例和截图
  - 编写常见问题解答
  - 编写故障排查指南
  - _验证需求: 10.4, 10.5_

- [ ] 6.8 Docker 部署支持
  - 编写 Dockerfile
  - 编写 docker-compose.yml
  - 测试 Docker 部署
  - 编写 Docker 部署文档
  - _验证需求: 7.5_

- [ ] 6.9 最终验证和发布准备
  - 运行所有测试确保通过
  - 检查代码质量和覆盖率
  - 检查文档完整性
  - 准备发布说明
  - _验证需求: 所有需求_

- [ ] 6.10 用户验收测试
  - 邀请用户测试系统
  - 收集用户反馈
  - 修复发现的问题
  - 确认用户满意度
  - _验证需求: 所有需求_

## 总结

本任务列表包含 5 个主要阶段，共 50+ 个任务项。每个任务都明确标注了验证的需求编号，并且包含了必要的属性测试和集成测试。

**测试策略**:
- 核心功能任务后紧跟属性测试任务
- 每个阶段结束有集成测试
- 最后阶段有端到端测试
- 所有测试任务都是必需的，确保从一开始就有全面的测试覆盖

**检查点**:
- 每个阶段结束都有验证步骤，确保所有测试通过
- 在继续下一阶段前询问用户是否有问题

**实施建议**:
- 按阶段顺序执行，确保每个阶段完成后再进入下一阶段
- 每个功能实现后立即编写对应的测试，确保质量
- 保持与 BettaFish 的架构一致性，最大程度复用代码
- 使用 Hypothesis 进行属性测试，pytest 进行单元和集成测试

## 变更记录

### 2025-11-22
- 移除阶段 4（TrendEngine 开发）的所有任务
- 移除 TrendDiscoveryAgent 相关任务（2.5, 2.6）
- 简化 Dashboard 开发任务，移除趋势图表相关任务
- 更新阶段编号：原阶段 5-6 重新编号为阶段 4-5
- 更新 Agent 集成测试，从三个 Agent 改为两个 Agent
- 更新端到端测试，移除趋势分析相关验证
